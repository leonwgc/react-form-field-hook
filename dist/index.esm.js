var P=(n,e,r)=>new Promise((t,m)=>{var b=a=>{try{f(r.next(a))}catch(d){m(d)}},T=a=>{try{f(r.throw(a))}catch(d){m(d)}},f=a=>a.done?t(a.value):Promise.resolve(a.value).then(b,T);f((r=r.apply(n,e)).next())});import ne from"react";import{useState as R,useCallback as s,useRef as w,useEffect as te,useMemo as D}from"react";var ae={required:(n="This field is required")=>e=>!e||!e.trim()?n:null,email:(n="Invalid email format")=>e=>e&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?n:null,minLength:(n,e)=>r=>r&&r.length<n?e||`Minimum ${n} characters`:null,maxLength:(n,e)=>r=>r&&r.length>n?e||`Maximum ${n} characters`:null,pattern:(n,e)=>r=>r&&!n.test(r)?e:null,min:(n,e)=>r=>{let t=typeof r=="string"?parseFloat(r):r;return!isNaN(t)&&t<n?e||`Minimum value is ${n}`:null},max:(n,e)=>r=>{let t=typeof r=="string"?parseFloat(r):r;return!isNaN(t)&&t>n?e||`Maximum value is ${n}`:null},url:(n="Invalid URL format")=>e=>{try{return e&&new URL(e),null}catch(r){return n}},number:(n="Must be a number")=>e=>e&&isNaN(Number(e))?n:null,integer:(n="Must be an integer")=>e=>e&&!Number.isInteger(Number(e))?n:null,matches:(n,e="Values do not match")=>r=>r!==n()?e:null,oneOf:(n,e)=>r=>n.includes(r)?null:e||`Must be one of: ${n.join(", ")}`,validate:(n,e)=>r=>P(null,null,function*(){return(yield Promise.resolve(n(r)))?null:e}),phone:(n="Invalid phone number")=>e=>e&&!/^[\d\s\-+()]{7,}$/.test(e)?n:null};function re(n={}){let{initialValue:e="",rules:r=[],validateOnChange:t=!0,validateOnBlur:m=!0,validateDebounce:b=0,transform:T,compareWith:f,onValueChange:a,onValidationChange:d,disabled:B=!1}=n,[u,p]=R(e),[v,h]=R(!1),[o,l]=R(!1),[F,$]=R(!1),[I,A]=R(null),[S,k]=R(!1),[g,q]=R(B),N=w(e),y=w(),U=w(0),O=w(e),K=D(()=>f?!f(u,N.current):u!==N.current,[u,f]),W=!K,x=I!==null,J=!x&&!S,H=s(i=>P(null,null,function*(){if(r.length===0)return null;let c=++U.current;k(!0);try{for(let L of r){let M=yield Promise.resolve(L(i));if(c!==U.current)return null;if(M)return k(!1),M}return k(!1),null}catch(L){return k(!1),"Validation error occurred"}}),[r]),j=s((i,c=!1)=>P(null,null,function*(){y.current&&clearTimeout(y.current);let L=()=>P(null,null,function*(){let M=yield H(i);A(M),d&&d(M===null,M)});c||b===0?yield L():y.current=setTimeout(L,b)}),[H,b,d]),V=s(i=>{if(g)return;let c=T?T(i):i;p(c),O.current=c,a&&a(c),t&&j(c)},[g,t,j,a,T]),E=s(()=>{h(!0),$(!1),m&&j(O.current,!0)},[m,j]),C=s(()=>{l(!0),$(!0)},[]),z=s(()=>P(null,null,function*(){let i=yield H(u);return A(i),h(!0),d&&d(i===null,i),i===null}),[u,H,d]),G=s(()=>{p(N.current),O.current=N.current,h(!1),l(!1),$(!1),A(null),k(!1),y.current&&clearTimeout(y.current)},[]),Q=s(i=>{N.current=i,p(i),O.current=i,h(!1),A(null)},[]),X=s(i=>{let c=T?T(i):i;p(c),O.current=c,a&&a(c)},[a,T]),Y=s(()=>({value:u,onChange:V,onBlur:E,onFocus:C,disabled:g}),[u,V,E,C,g]),Z=s(()=>({value:u,onChange:i=>V(i.target.value),onBlur:E,onFocus:C,disabled:g}),[u,V,E,C,g]),_=s(()=>({value:u,onChange:i=>V(i.target.value),onBlur:E,onFocus:C,status:v&&x?"error":void 0,disabled:g}),[u,V,E,C,v,x,g]),ee=s((i="form-field-error")=>!v||!x||!I||F?null:ne.createElement("div",{className:i},I),[v,x,I,F]);return te(()=>()=>{y.current&&clearTimeout(y.current)},[]),{value:u,touched:v,dirty:K,pristine:W,valid:J,invalid:x,error:I,validating:S,visited:o,focused:F,disabled:g,onChange:V,onBlur:E,onFocus:C,setValue:X,reset:G,validate:z,setError:A,setTouched:h,setDisabled:q,setInitialValue:Q,getInputProps:Y,getHTMLInputProps:Z,getAntdInputProps:_,renderError:ee}}function le(n){let e=Object.keys(n),r=e.map(o=>{let l=re(n[o]);return[o,l]}),t=Object.fromEntries(r),m=s(()=>P(null,null,function*(){return(yield Promise.all(e.map(l=>t[l].validate()))).every(l=>l)}),[t,e]),b=s(()=>{e.forEach(o=>t[o].reset())},[t,e]),T=s(()=>Object.fromEntries(e.map(o=>[o,t[o].value])),[t,e]),f=s(o=>{Object.entries(o).forEach(([l,F])=>{l in t&&t[l].setValue(F)})},[t]),a=s(o=>{Object.entries(o).forEach(([l,F])=>{l in t&&t[l].setInitialValue(F)})},[t]),d=D(()=>e.some(o=>t[o].dirty),[t,e]),B=D(()=>e.every(o=>t[o].valid),[t,e]),u=s(()=>Object.fromEntries(e.map(o=>[o,t[o].error])),[t,e]),p=s(o=>{e.forEach(l=>t[l].setDisabled(o))},[t,e]),v=D(()=>e.every(o=>t[o].disabled),[t,e]),h=D(()=>({validateAll:m,resetAll:b,getValues:T,setValues:f,setInitialValues:a,isDirty:d,isValid:B,getErrors:u,setDisabled:p,isDisabled:v}),[m,b,T,f,a,d,B,u,p,v]);return{fields:t,form:h}}export{re as useFormField,le as useFormFields,ae as validators};
