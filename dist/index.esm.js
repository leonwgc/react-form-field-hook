var P=(n,e,r)=>new Promise((t,m)=>{var b=a=>{try{T(r.next(a))}catch(d){m(d)}},c=a=>{try{T(r.throw(a))}catch(d){m(d)}},T=a=>a.done?t(a.value):Promise.resolve(a.value).then(b,c);T((r=r.apply(n,e)).next())});import ee from"react";import{useState as R,useCallback as s,useRef as w,useEffect as ne,useMemo as U}from"react";var se={required:(n="This field is required")=>e=>!e||!e.trim()?n:null,email:(n="Invalid email format")=>e=>e&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?n:null,minLength:(n,e)=>r=>r&&r.length<n?e||`Minimum ${n} characters`:null,maxLength:(n,e)=>r=>r&&r.length>n?e||`Maximum ${n} characters`:null,pattern:(n,e)=>r=>r&&!n.test(r)?e:null,min:(n,e)=>r=>{let t=typeof r=="string"?parseFloat(r):r;return!isNaN(t)&&t<n?e||`Minimum value is ${n}`:null},max:(n,e)=>r=>{let t=typeof r=="string"?parseFloat(r):r;return!isNaN(t)&&t>n?e||`Maximum value is ${n}`:null},url:(n="Invalid URL format")=>e=>{try{return e&&new URL(e),null}catch(r){return n}},number:(n="Must be a number")=>e=>e&&isNaN(Number(e))?n:null,integer:(n="Must be an integer")=>e=>e&&!Number.isInteger(Number(e))?n:null,matches:(n,e="Values do not match")=>r=>r!==n()?e:null,oneOf:(n,e)=>r=>n.includes(r)?null:e||`Must be one of: ${n.join(", ")}`,validate:(n,e)=>r=>P(null,null,function*(){return(yield Promise.resolve(n(r)))?null:e}),phone:(n="Invalid phone number")=>e=>e&&!/^[\d\s\-+()]{7,}$/.test(e)?n:null};function te(n={}){let{initialValue:e="",rules:r=[],validateOnChange:t=!0,validateOnBlur:m=!0,validateDebounce:b=0,transform:c,compareWith:T,onValueChange:a,onValidationChange:d,disabled:O=!1}=n,[l,p]=R(e),[v,h]=R(!1),[o,u]=R(!1),[F,H]=R(!1),[M,A]=R(null),[j,k]=R(!1),[g,K]=R(O),L=w(e),V=w(),$=w(0),S=U(()=>T?!T(l,L.current):l!==L.current,[l,T]),q=!S,x=M!==null,W=!x&&!j,D=s(i=>P(null,null,function*(){if(r.length===0)return null;let f=++$.current;k(!0);try{for(let N of r){let I=yield Promise.resolve(N(i));if(f!==$.current)return null;if(I)return k(!1),I}return k(!1),null}catch(N){return k(!1),"Validation error occurred"}}),[r]),B=s((i,f=!1)=>P(null,null,function*(){V.current&&clearTimeout(V.current);let N=()=>P(null,null,function*(){let I=yield D(i);A(I),d&&d(I===null,I)});f||b===0?yield N():V.current=setTimeout(N,b)}),[D,b,d]),y=s(i=>{if(g)return;let f=c?c(i):i;p(f),a&&a(f),t&&B(f)},[g,t,B,a,c]),E=s(()=>{h(!0),H(!1),m&&B(l,!0)},[l,m,B]),C=s(()=>{u(!0),H(!0)},[]),J=s(()=>P(null,null,function*(){let i=yield D(l);return A(i),h(!0),d&&d(i===null,i),i===null}),[l,D,d]),z=s(()=>{p(L.current),h(!1),u(!1),H(!1),A(null),k(!1),V.current&&clearTimeout(V.current)},[]),G=s(i=>{L.current=i,p(i),h(!1),A(null)},[]),Q=s(i=>{let f=c?c(i):i;p(f),a&&a(f)},[a,c]),X=s(()=>({value:l,onChange:y,onBlur:E,onFocus:C,disabled:g}),[l,y,E,C,g]),Y=s(()=>({value:l,onChange:i=>y(i.target.value),onBlur:E,onFocus:C,disabled:g}),[l,y,E,C,g]),Z=s(()=>({value:l,onChange:i=>y(i.target.value),onBlur:E,onFocus:C,status:v&&x?"error":void 0,disabled:g}),[l,y,E,C,v,x,g]),_=s((i="form-field-error")=>!v||!x||!M||F?null:ee.createElement("div",{className:i},M),[v,x,M,F]);return ne(()=>()=>{V.current&&clearTimeout(V.current)},[]),{value:l,touched:v,dirty:S,pristine:q,valid:W,invalid:x,error:M,validating:j,visited:o,focused:F,disabled:g,onChange:y,onBlur:E,onFocus:C,setValue:Q,reset:z,validate:J,setError:A,setTouched:h,setDisabled:K,setInitialValue:G,getInputProps:X,getHTMLInputProps:Y,getAntdInputProps:Z,renderError:_}}function ae(n){let e=Object.keys(n),r=e.map(o=>{let u=te(n[o]);return[o,u]}),t=Object.fromEntries(r),m=s(()=>P(null,null,function*(){return(yield Promise.all(e.map(u=>t[u].validate()))).every(u=>u)}),[t,e]),b=s(()=>{e.forEach(o=>t[o].reset())},[t,e]),c=s(()=>Object.fromEntries(e.map(o=>[o,t[o].value])),[t,e]),T=s(o=>{Object.entries(o).forEach(([u,F])=>{u in t&&t[u].setValue(F)})},[t]),a=s(o=>{Object.entries(o).forEach(([u,F])=>{u in t&&t[u].setInitialValue(F)})},[t]),d=s(()=>e.some(o=>t[o].dirty),[t,e]),O=s(()=>e.every(o=>t[o].valid),[t,e]),l=s(()=>Object.fromEntries(e.map(o=>[o,t[o].error])),[t,e]),p=s(o=>{e.forEach(u=>t[u].setDisabled(o))},[t,e]),v=s(()=>e.every(o=>t[o].disabled),[t,e]),h=U(()=>({validateAll:m,resetAll:b,getValues:c,setValues:T,setInitialValues:a,isDirty:d,isValid:O,getErrors:l,setDisabled:p,isDisabled:v}),[m,b,c,T,a,d,O,l,p,v]);return{fields:t,form:h}}export{te as useFormField,ae as useFormFields,se as validators};
